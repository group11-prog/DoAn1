<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang | default "vi" }}">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ .Title }} | Mobile Center</title>
    
    <link rel="stylesheet" href="{{ "/css/product-style.css" | relURL }}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    
    {{ hugo.Generator }}

    <style>
        #user-info-modal .modal-content { text-align: center; max-width: 400px; }
        #user-info-modal h2 { font-size: 2rem; font-weight: 800; margin-bottom: 10px; }
        .promo-text { color: #d70018; font-weight: bold; font-size: 1.1rem; margin-bottom: 20px; }
        .voucher-box-dashed { border: 2px dashed #d70018; background-color: #fff0f0; padding: 15px; border-radius: 8px; margin-bottom: 20px; color: #d70018; font-weight: 700; }
        .input-group { text-align: left; margin-bottom: 15px; }
        .input-group label { display: block; font-weight: 600; margin-bottom: 5px; }
        .input-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 1rem; }
        #save-user-info { width: 100%; background: #007bff; color: white; padding: 12px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #save-user-info:hover { background: #0056b3; }
        
        /* Class ch·∫∑n click chu·ªôt (khi c·∫ßn thi·∫øt) */
        .no-click { pointer-events: none; }
    </style>
</head>
<body>

    <nav class="main-navbar">
        <div class="navbar-container">
            <a href="{{ "/" | relURL }}" class="navbar-brand">Mobile Center</a>
            <div class="navbar-links">
                <a href="{{ "/" | relURL }}" class="nav-link">Trang ch·ªß</a>
                <a href="{{ "/san-pham" | relURL }}" class="nav-link">S·∫£n ph·∫©m</a>
                <a href="#" class="nav-link" id="global-cart-button">
                    <i class="fas fa-shopping-cart"></i> Gi·ªè h√†ng
                    <span id="global-cart-badge" class="cart-badge hidden">0</span>
                </a>
            </div>
        </div>
    </nav>

    <main id="main-content">
        {{ block "main" . }}{{ end }}
    </main>

    <footer class="site-footer">
        <div class="footer-wrapper">
            <div class="footer-col">
                <h3>Mobile Center</h3>
                <p style="color: #ccc; line-height: 1.6;">
                    H·ªá th·ªëng b√°n l·∫ª ƒëi·ªán tho·∫°i ch√≠nh h√£ng uy t√≠n nh·∫•t. <br>
                    Cam k·∫øt ch·∫•t l∆∞·ª£ng, gi√° c·∫£ c·∫°nh tranh.
                </p>
            </div>

            <div class="footer-col">
                <h3>Th√¥ng tin li√™n h·ªá</h3>
                <div class="footer-info">
                    <p>
                        <i class="fas fa-phone-alt"></i> 
                        <a href="tel:0848921193">0848921193</a>
                    </p>
                    <p>
                        <i class="fas fa-envelope"></i> 
                        <a href="mailto:dbinh1312@gmail.com">dbinh1312@gmail.com</a>
                    </p>
                    <p>
                        <i class="fab fa-facebook-f"></i> 
                        <a href="https://www.facebook.com/ltdb.2910" target="_blank">L√™ Tr·ªãnh Duy B√¨nh</a>
                    </p>
                </div>
            </div>
        </div>
        
        <div class="copyright">
            &copy; 2025 Mobile Center. All rights reserved.
        </div>
    </footer>

    <div id="user-info-modal" class="modal-overlay hidden" data-locked="true">
        <div class="modal-content">
            <h2>Ch√†o m·ª´ng!</h2>
            <p class="promo-text">Cho ch√∫ng m√¨nh xin th√¥ng tin li√™n h·ªá nh√© !!!</p>
            <div class="voucher-box-dashed">üéâ T·∫∑ng voucher gi·∫£m gi√° khi b·∫°n l√† sinh vi√™n ƒêH KHTN !!! üéÜ</div>
            <div class="input-group">
                <label>T√™n c·ªßa b·∫°n <span style="color:red">*</span></label>
                <input type="text" id="user-name-input" placeholder="Nguy·ªÖn VƒÉn A">
            </div>
            <div class="input-group">
                <label>S·ªë ƒëi·ªán tho·∫°i <span style="color:red">*</span></label>
                <input type="tel" id="user-phone-input" placeholder="09xxxxxxxx">
            </div>
            <button id="save-user-info">L∆∞u th√¥ng tin</button>
        </div>
    </div>

    <div id="cart-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="close-modal" id="close-cart-btn-x">&times;</span>
            <h2>Gi·ªè h√†ng c·ªßa b·∫°n</h2>
            <ul id="cart-item-list"></ul>
            <div class="cart-total">
                <strong>T·ªïng c·ªông:</strong>
                <strong id="cart-total-price">0ƒë</strong>
            </div>
            <div style="text-align:right; margin-top:10px;">
                <button id="clear-cart-button" style="background:none; border:none; color:red; text-decoration:underline; cursor:pointer;">X√≥a gi·ªè h√†ng</button>
            </div>
            <div class="cart-buttons">
                <button id="close-cart-modal">Ti·∫øp t·ª•c mua</button>
                <button id="go-to-checkout">Thanh to√°n</button>
            </div>
        </div>
    </div>

    <script>
      function formatCurrencyGlobal(value) {
        return new Intl.NumberFormat("vi-VN", { style: "currency", currency: "VND" }).format(value);
      }
      
      let globalCartItems = [];
      const cartModal = document.getElementById("cart-modal");
      const badge = document.getElementById("global-cart-badge");

      function updateBadge() {
        let total = 0;
        if(globalCartItems) total = globalCartItems.reduce((acc, item) => acc + item.quantity, 0);
        if (total > 0) {
          badge.textContent = total;
          badge.classList.remove("hidden");
        } else {
          badge.classList.add("hidden");
        }
      }

      function loadCart() {
        globalCartItems = JSON.parse(sessionStorage.getItem("shoppingCart")) || [];
        updateBadge();
      }

      function renderCart() {
        const list = document.getElementById("cart-item-list");
        const totalEl = document.getElementById("cart-total-price");
        list.innerHTML = "";
        let total = 0;
        if (globalCartItems.length === 0) {
          list.innerHTML = "<li style='text-align:center; padding:20px;'>Gi·ªè h√†ng tr·ªëng.</li>";
          totalEl.textContent = formatCurrencyGlobal(0);
          return;
        }
        globalCartItems.forEach((item) => {
          total += item.price * item.quantity;
          list.innerHTML += `
            <li style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #eee;">
              <div><strong>${item.name}</strong><br><small>${item.variant} - ${item.color} (x${item.quantity})</small></div>
              <div style="color:#d70018; font-weight:bold;">${formatCurrencyGlobal(item.price * item.quantity)}</div>
            </li>`;
        });
        totalEl.textContent = formatCurrencyGlobal(total);
      }
      
      function checkUserPopup() {
          const userInfo = sessionStorage.getItem("userInfo");
          const userModal = document.getElementById("user-info-modal");
          
          // N·∫øu ch∆∞a c√≥ th√¥ng tin th√¨ HI·ªÜN v√† KH√ìA
          if (!userInfo) {
              setTimeout(() => { 
                  userModal.classList.remove("hidden"); 
              }, 500);
          }
      }

      document.addEventListener("DOMContentLoaded", function () {
        loadCart();
        checkUserPopup();

        // X·ª≠ l√Ω n√∫t L∆∞u th√¥ng tin
        document.getElementById("save-user-info").addEventListener("click", function() {
            const name = document.getElementById("user-name-input").value.trim();
            const phone = document.getElementById("user-phone-input").value.trim();
            
            if(name && phone) {
                const info = { name: name, phone: phone };
                sessionStorage.setItem("userInfo", JSON.stringify(info));
                alert("Ch√†o m·ª´ng " + name + "!");
                document.getElementById("user-info-modal").classList.add("hidden");
            } else {
                alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!");
            }
        });

        // --- LOGIC CH·∫∂N ƒê√ìNG POPUP ---
        const userModal = document.getElementById("user-info-modal");
        
        // Ch·∫∑n click ra ngo√†i (ch·ªâ √°p d·ª•ng cho modal user)
        userModal.addEventListener("click", function(e) {
            // NgƒÉn ch·∫∑n s·ª± ki·ªán ƒë√≥ng n·∫øu click v√†o v√πng t·ªëi (overlay)
            if (e.target === userModal) {
                e.stopPropagation();
                e.preventDefault();
                // C√≥ th·ªÉ th√™m hi·ªáu ·ª©ng rung l·∫Øc ·ªü ƒë√¢y ƒë·ªÉ b√°o hi·ªáu
                const content = userModal.querySelector('.modal-content');
                content.style.transform = "scale(1.02)";
                setTimeout(() => content.style.transform = "scale(1)", 100);
            }
        });

        // --- Logic Gi·ªè h√†ng (Cho ph√©p ƒë√≥ng b√¨nh th∆∞·ªùng) ---
        const closeCart = () => cartModal.classList.add("hidden");
        
        document.getElementById("global-cart-button").addEventListener("click", function(e) {
            e.preventDefault();
            renderCart();
            cartModal.classList.remove("hidden");
        });
        
        document.getElementById("close-cart-btn-x").addEventListener("click", closeCart);
        document.getElementById("close-cart-modal").addEventListener("click", closeCart);
        
        // Gi·ªè h√†ng th√¨ CHO PH√âP click ra ngo√†i ƒë·ªÉ ƒë√≥ng
        cartModal.addEventListener("click", (e) => { 
            if(e.target === cartModal) closeCart(); 
        });

        document.getElementById("clear-cart-button").addEventListener("click", function() {
            if(confirm("X√≥a h·∫øt gi·ªè h√†ng?")) {
                globalCartItems = [];
                sessionStorage.setItem("shoppingCart", JSON.stringify(globalCartItems));
                renderCart();
                updateBadge();
            }
        });
      });
      
      window.addToCartLocal = function(item) {
          loadCart();
          const existing = globalCartItems.find(i => i.name === item.name && i.variant === item.variant && i.color === item.color);
          if(existing) existing.quantity += item.quantity;
          else globalCartItems.push(item);
          sessionStorage.setItem("shoppingCart", JSON.stringify(globalCartItems));
          updateBadge();
          renderCart();
          cartModal.classList.remove("hidden");
      };
    </script>
</body>
</html>